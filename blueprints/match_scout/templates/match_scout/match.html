{% extends "layouts/default.html" %}
{% block content %}

{% include "includes/search.html" %}

<h1>Match #{{match.match}}</h1>

{% include "includes/add_match_report_button.html" %}

<hr>

<h3>Blue Alliance</h3>

<div class="accordion" id="blue-alliance-data">
{% for match_report in match.match_reports %}
  {% if match_report.alliance == "Blue" %}
    <div class="card">
      <div class="d-flex flex-row flex-wrap card-header" id="heading-blue-alliance-team-{{match_report.station}}">
        <h2 class="mb-0">
          <button class="btn btn-link" type="button" data-toggle="collapse" data-target="#body-blue-alliance-team-{{match_report.station}}" aria-expanded="true" aria-controls="blueAllianceTeam{{match_report.station}}">
            Team {{match_report.team.team_number}}
          </button>
        </h2>
        <a class="btn btn-primary" role="button" href="{{url_for('team.profile', team_number=match_report.team.team_number)}}">View Team Profile</a>
        <a class="btn btn-primary" role="button" href="{{url_for('match_scout.edit_match_report', match_report_id=match_report.id)}}">Edit Match Report</a>
        <button type="button" class="btn btn-danger" data-toggle="modal" data-target="#delete-match-report-{{match_report.id}}">Delete Match Report</button>
      </div>
      <div id="body-blue-alliance-team-{{match_report.station}}" class="collapse show" aria-labelledby="blueAllianceTeam{{match_report.station}}" data-parent="#blue-alliance-data">
        <div class="card-body">
          <h5>Auto</h5>
          <ul>
            <li>Move: {{match_report.auto_move}}</li>
            <li>Collect Balls: {{match_report.auto_collect_balls}}</li>
            <li>Score Bottom: {{match_report.auto_score_bottom}}</li>
            <li>Score Upper: {{match_report.auto_score_upper}}</li>
            <li>Points: {{match_report.auto_points}}</li>
          </ul>

          <h5>Teleop</h5>
          <ul>
            <li>Score Bottom: {{match_report.teleop_score_bottom}}</li>
            <li>Score Upper: {{match_report.teleop_score_upper}}</li>
            <li>Attempts: {{match_report.teleop_attempts}}</li>
            <li>Points: {{match_report.teleop_points}}</li>
            <li>Success Rate: {{(match_report.teleop_success_rate * 100) | round(2)}}%</li>
          </ul>
          
          <h5>Control Panel</h5>
          <ul>
            <li>Rotation: {{match_report.control_panel_rotation}}</li>
            <li>Position: {{match_report.control_panel_position}}</li>
          </ul>

          <h5>Hang</h5>
          <ul>
            <li>Able: {{match_report.hang_able}}</li>
            <li>Level: {{match_report.hang_level}}</li>
            <li>Position: {{match_report.hang_position}}</li>
            <li>Active: {{match_report.hang_active}}</li>
            <li>Points: {{match_report.hang_points}}</li>
          </ul>

          <h5>Defense</h5>
          <ul>
            <li>Performance (1-5): {{match_report.defense_performance}}</li>
            <li>Penalties: {{match_report.defense_penalties}}</li>
          </ul>

          <h5>Comms</h5>
          <ul>
            <li>Connection Issues: {{match_report.connection_issues}}</li>
            <li>Brownouts: {{match_report.brownouts}}</li>
            <li>Emergency Stop: {{match_report.emergency_stop}}</li>
          </ul>

          <h5>Misc</h5>
          <p class="card-text">
            {% autoescape false %}
              {{match_report.notes | replace("\n", "<br>")}}
            {% endautoescape %}
          </p>
        </div>
      </div>
    </div>
  {% endif %}
{% endfor %}
</div>

<h3>Red Alliance</h3>

<div class="accordion" id="red-alliance-data">
{% for match_report in match.match_reports %}
  {% if match_report.alliance == "Red" %}
    <div class="card">
      <div class="d-flex flex-row flex-wrap card-header" id="heading-red-alliance-team-{{match_report.station}}">
        <h2 class="mb-0">
          <button class="btn btn-link" type="button" data-toggle="collapse" data-target="#body-red-alliance-team-{{match_report.station}}" aria-expanded="true" aria-controls="redAllianceTeam{{match_report.station}}">
            Team {{match_report.team_number}}
          </button>
        </h2>
        <a class="btn btn-primary" role="button" href="{{url_for('team.profile', team_number=match_report.team_number)}}">View Team Profile</a>
        <a class="btn btn-primary" role="button" href="{{url_for('match_scout.edit_match_report', match_report_id=match_report.id)}}">Edit Match Report</a>
        <button type="button" class="btn btn-danger" data-toggle="modal" data-target="#delete-match-report-{{match_report.id}}">Delete Match Report</button>
      </div>
      <div id="body-red-alliance-team-{{match_report.station}}" class="collapse show" aria-labelledby="redAllianceTeam{{match_report.station}}" data-parent="#red-alliance-data">
        <div class="card-body">
          <h5>Auto</h5>
          <ul>
            <li>Move: {{match_report.auto_move}}</li>
            <li>Collect Balls: {{match_report.auto_collect_balls}}</li>
            <li>Score Bottom: {{match_report.auto_score_bottom}}</li>
            <li>Score Upper: {{match_report.auto_score_upper}}</li>
            <li>Points: {{match_report.auto_points}}</li>
          </ul>

          <h5>Teleop</h5>
          <ul>
            <li>Score Bottom: {{match_report.teleop_score_bottom}}</li>
            <li>Score Upper: {{match_report.teleop_score_upper}}</li>
            <li>Attempts: {{match_report.teleop_attempts}}</li>
            <li>Points: {{match_report.teleop_points}}</li>
            <li>Success Rate: {{(match_report.teleop_success_rate * 100) | round(2)}}%</li>
          </ul>
          
          <h5>Control Panel</h5>
          <ul>
            <li>Rotation: {{match_report.control_panel_rotation}}</li>
            <li>Position: {{match_report.control_panel_position}}</li>
          </ul>

          <h5>Hang</h5>
          <ul>
            <li>Able: {{match_report.hang_able}}</li>
            <li>Level: {{match_report.hang_level}}</li>
            <li>Position: {{match_report.hang_position}}</li>
            <li>Active: {{match_report.hang_active}}</li>
            <li>Points: {{match_report.hang_points}}</li>
          </ul>

          <h5>Defense</h5>
          <ul>
            <li>Performance (1-5): {{match_report.defense_performance}}</li>
            <li>Penalties: {{match_report.defense_penalties}}</li>
          </ul>

          <h5>Comms</h5>
          <ul>
            <li>Connection Issues: {{match_report.connection_issues}}</li>
            <li>Brownouts: {{match_report.brownouts}}</li>
            <li>Emergency Stop: {{match_report.emergency_stop}}</li>
          </ul>

          <h5>Misc</h5>
          <p class="card-text">
            {% autoescape false %}
              {{match_report.notes | replace("\n", "<br>")}}
            {% endautoescape %}
          </p>
        </div>
      </div>
    </div>
  {% endif %}
{% endfor %}
</div>

{% for match_report in match.match_reports %}
<div class="modal fade" id="delete-match-report-{{match_report.id}}" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Delete Match Report</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        Are you sure you want to delete this match report?
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
        <form method="POST" action="{{url_for('match_scout.delete_match_report', match_report_id=match_report.id)}}">
          <button type="submit" class="btn btn-danger">Delete Match Report</button>
        </form>
      </div>
    </div>
  </div>
</div>
{% endfor %}

{% endblock %}